---
import { sanityClient } from "sanity:client";
import { type Slug, type ImageAsset } from "@sanity/types";
import Prototype from "../../layouts/Prototype.astro";
import { urlForImage } from "../../sanity/urlForImage";

export async function getStaticPaths() {
  const posts = await sanityClient.fetch(`*[_type == "labReport"]`);

  return posts.map(({ 
    slug, title, subtitle, headerImageAssets
  }: { 
    slug: Slug, 
    title: string,
    subtitle: string,
    headerImageAssets: ImageAsset[]
  }) => {
    const headerImageUrls = headerImageAssets
        .map((asset: ImageAsset) => urlForImage(asset).url);
        
    return {
      params: { slug: slug.current },
      props: { title, subtitle, headerImageUrls },
    };
  });
}

const { slug  } = Astro.params;
const { title, subtitle, headerImageUrls } = Astro.props;
---

<Prototype
  title={title} slug={slug} subtitle={subtitle}
  heroSrcArray={headerImageUrls}>
</Prototype>
